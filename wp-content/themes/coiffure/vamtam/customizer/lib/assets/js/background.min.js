!function(a){"use strict";wp.customize.controlConstructor["vamtam-background"]=wp.customize.Control.extend({ready:function(){var i=this,n={};_.each(i.params.default,function(e,t){!1!==e&&(n[t]=e,i.params.value[t]!==i.setting._value[t]&&i.params.value.hasOwnProperty(t)&&(i.setting._value[t]=i.params.value[t]),a!==i.setting._value[t])&&(n[t]=i.setting._value[t])}),_.each(i.setting._value,function(e,t){a!==n[t]&&void 0!==n[t]||(n[t]=e)}),i.value=n,i.params.value=n,_.bindAll(i,"removeFile","openFrame","select"),i.container.on("click keydown",".upload-button",i.openFrame),i.container.on("click keydown",".thumbnail-image img",i.openFrame),i.container.on("click keydown",".remove-button",i.removeFile),VAMTAM_CUSTOMIZER.controls.addSelectsChangeHandlers(this,n),VAMTAM_CUSTOMIZER.controls.addInputsChangeHandlers(this,n),i.initializeColorPickers(),i.container.on("change",'.background-type input[type="radio"], .background-gradient-type select',function(){i.renderContent(),i.initializeColorPickers()})},initializeColorPickers:function(){VAMTAM_CUSTOMIZER.controls.addColorPickerHandlers(this,this.value)},openFrame:function(e){wp.customize.utils.isKeydownButNotEnterEvent(e)||(e.preventDefault(),this.frame||this.initFrame(),this.frame.open())},initFrame:function(){this.frame=wp.media({button:{text:this.params.button_labels.frame_button},states:[new wp.media.controller.Library({title:this.params.button_labels.frame_title,library:wp.media.query({type:this.params.mime_type}),multiple:!1,date:!1})]}),this.frame.on("select",this.select)},select:function(){var e=this.frame.state().get("selection").first().toJSON();this.setImage(e)},removeFile:function(e){wp.customize.utils.isKeydownButNotEnterEvent(e)||(e.preventDefault(),this.setImage({}))},setImage:function(e){this.value["background-image"]=e?e.url:"",this.value["background-image-attachment"]=e||"",VAMTAM_CUSTOMIZER.controls.saveValue(this.value,this),this.renderContent(),this.initializeColorPickers()}})}(void jQuery);